<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Form Validator</title>
    <style>
        .form-container {
            max-width: 400px;
            margin: 50px auto;
            padding: 30px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .form-group { margin-bottom: 20px; }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            outline: none;
        }

        input.valid { border-color: #28a745; }
        input.invalid { border-color: #dc3545; }

        .error-message {
            color: #dc3545;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .error-message.show { display: block; }

        button[type="submit"] {
            width: 100%;
            padding: 12px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }

        button[type="submit"]:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <h2>Sign Up Form</h2>

        <!-- 'novalidate' prevents the browser's native messages from interfering -->
        <form id="signupForm" novalidate>
            <!-- Username -->
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" placeholder="Enter username" autocomplete="username" />
                <div class="error-message" id="usernameError" aria-live="polite"></div>
            </div>

            <!-- Email -->
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" placeholder="Enter email" autocomplete="email" />
                <div class="error-message" id="emailError" aria-live="polite"></div>
            </div>

            <!-- Password -->
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Enter password" autocomplete="new-password" />
                <div class="error-message" id="passwordError" aria-live="polite"></div>
            </div>

            <!-- Confirm Password -->
            <div class="form-group">
                <label for="confirmPassword">Confirm Password</label>
                <input type="password" id="confirmPassword" placeholder="Confirm password" autocomplete="new-password" />
                <div class="error-message" id="confirmPasswordError" aria-live="polite"></div>
            </div>

            <button type="submit" id="submitBtn" disabled>Sign Up</button>
        </form>
    </div>

    <script>
        // -----------------------------
        // Validation patterns (rules)
        // -----------------------------
        // Username: 4–20 chars, letters, numbers, or underscores (matches expected 'john_doe123')
        const USERNAME_REGEX = /^[a-zA-Z0-9]{4,20}$/;
        // Email: simple, practical pattern
        const EMAIL_REGEX = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        // Password: at least 8 chars, at least one uppercase and one number
        const PASSWORD_REGEX = /^(?=.*[A-Z])(?=.*\d).{8,}$/;

        // -----------------------------
        // Required functions
        // -----------------------------
        function validateUsername(username) {
            return USERNAME_REGEX.test(username);
        }

        function validateEmail(email) {
            return EMAIL_REGEX.test(email);
        }

        function validatePassword(password) {
            return PASSWORD_REGEX.test(password);
        }

        function validatePasswordMatch(pass1, pass2) {
            return pass1 === pass2 && pass1 !== '';
        }

        // -----------------------------
        // UI helpers
        // -----------------------------
        function showError(fieldId, message) {
            const errorDiv = document.getElementById(fieldId + 'Error');
            const input = document.getElementById(fieldId);
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
            input.classList.add('invalid');
            input.classList.remove('valid');
        }

        function clearError(fieldId) {
            const errorDiv = document.getElementById(fieldId + 'Error');
            const input = document.getElementById(fieldId);
            errorDiv.textContent = '';
            errorDiv.classList.remove('show');
            input.classList.add('valid');
            input.classList.remove('invalid');
        }

        function resetField(fieldId) {
            const errorDiv = document.getElementById(fieldId + 'Error');
            const input = document.getElementById(fieldId);
            errorDiv.textContent = '';
            errorDiv.classList.remove('show');
            input.classList.remove('valid', 'invalid');
        }

        // -----------------------------
        // Validation orchestration
        // -----------------------------
        const state = { username: false, email: false, password: false, confirmPassword: false };
        const touched = { username: false, email: false, password: false, confirmPassword: false };

        function validateForm() {
            const usernameEl = document.getElementById('username');
            const emailEl = document.getElementById('email');
            const passwordEl = document.getElementById('password');
            const confirmEl = document.getElementById('confirmPassword');
            const submitBtn = document.getElementById('submitBtn');

            const username = usernameEl.value.trim();
            const email = emailEl.value.trim();
            const password = passwordEl.value;
            const confirm = confirmEl.value;

            // Username
            if (username === '') {
                state.username = false;
                if (touched.username) showError('username', 'Username is required');
                else resetField('username');
            } else if (!validateUsername(username)) {
                state.username = false;
                showError('username', 'Username must be 4–20 characters; letters, numbers, underscores only');
            } else {
                state.username = true;
                clearError('username');
            }

            // Email
            if (email === '') {
                state.email = false;
                if (touched.email) showError('email', 'Email is required');
                else resetField('email');
            } else if (!validateEmail(email)) {
                state.email = false;
                showError('email', 'Please enter a valid email (e.g., name@example.com)');
            } else {
                state.email = true;
                clearError('email');
            }

            // Password
            if (password === '') {
                state.password = false;
                if (touched.password) showError('password', 'Password is required');
                else resetField('password');
            } else if (!validatePassword(password)) {
                state.password = false;
                showError('password', 'Min 8 chars, include 1 uppercase and 1 number');
            } else {
                state.password = true;
                clearError('password');
            }

            // Confirm Password
            if (confirm === '') {
                state.confirmPassword = false;
                if (touched.confirmPassword) showError('confirmPassword', 'Please confirm your password');
                else resetField('confirmPassword');
            } else if (!validatePasswordMatch(password, confirm)) {
                state.confirmPassword = false;
                showError('confirmPassword', 'Passwords do not match');
            } else {
                state.confirmPassword = true;
                clearError('confirmPassword');
            }

            // Enable submit when all valid
            submitBtn.disabled = !(state.username && state.email && state.password && state.confirmPassword);
        }

        // -----------------------------
        // Real-time validation
        // -----------------------------
        const fieldIds = ['username', 'email', 'password', 'confirmPassword'];
        fieldIds.forEach(id => {
            const el = document.getElementById(id);

            // Mark as touched and validate as user types
            el.addEventListener('input', () => {
                touched[id] = true;
                validateForm();
            });

            // Also validate on blur for users who tab through fields
            el.addEventListener('blur', () => {
                touched[id] = true;
                validateForm();
            });
        });

        // -----------------------------
        // Submit handler
        // -----------------------------
        document.getElementById('signupForm').addEventListener('submit', function (e) {
            e.preventDefault();
            // Force all touched on submit, then validate
            fieldIds.forEach(id => (touched[id] = true));
            validateForm();

            const allValid = Object.values(state).every(Boolean);
            if (allValid) {
                alert('Form submitted successfully!');
                // Optional reset block:
                // this.reset();
                // fieldIds.forEach(id => { touched[id] = false; resetField(id); });
                // document.getElementById('submitBtn').disabled = true;
            }
        });
    </script>
</body>
</html>
